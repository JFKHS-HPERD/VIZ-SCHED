<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Schedule with IEP Logging</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        #image-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        img {
            width: 150px;
            height: 150px;
            cursor: pointer;
        }
        .full-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: contain;
            background-color: white;
        }
        #retry {
            display: none;
        }
        #reset-button {
            display: none;
            margin-top: 20px;
        }
        #session-log {
            margin-top: 20px;
            width: 80%;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #fff;
        }
        .session-entry {
            margin-bottom: 10px;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <h1>Hi Mac!
    <br> What are we doing next?</h1>

    <label for="activity-select">Choose the correct activity:</label>
    <select id="activity-select">
        <option value="warmup">Warm Up</option>
        <option value="walk">Walk</option>
        <option value="classroom">Classroom</option>
        <option value="gym">Gym</option>
        <option value="bus">Bus</option>
    </select>

    <div id="image-container">
        <img src="warmup.png" id="warmup" alt="Warm Up">
        <img src="walk.png" id="walk" alt="Walk">
        <img src="classroom.png" id="classroom" alt="Classroom">
        <img src="gym.png" id="gym" alt="Gym">
        <img src="bus.png" id="bus" alt="Bus">
    </div>

    <label for="independence-select">Did the student act independently?</label>
    <select id="independence-select">
        <option value="yes">Yes</option>
        <option value="no">No</option>
    </select>

    <label for="comments">Comments:</label>
    <textarea id="comments" rows="4" cols="50" placeholder="Add any notes or comments..."></textarea>

    <button id="save-session" onclick="saveSession()">Save Session</button>

    <div id="session-log">
        <h2>Session Log</h2>
        <div id="log-entries"></div>
    </div>

    <img id="retry" src="retry.png" alt="Try Again">

    <button id="reset-button" onclick="resetApp()">Try Again</button>
    <button id="export-log" onclick="exportLog()">Export All Sessions</button>

    <script>
        const images = document.querySelectorAll('#image-container img');
        const retryImg = document.getElementById('retry');
        const resetButton = document.getElementById('reset-button');
        const correctActivity = document.getElementById('activity-select');
        const goalSelect = document.getElementById('goal-select');
        const independenceSelect = document.getElementById('independence-select');
        const commentsField = document.getElementById('comments');
        const logEntries = document.getElementById('log-entries');
        const log = [];

        images.forEach(image => {
            image.addEventListener('click', function() {
                checkSelection(this.id);
            });
        });

        function checkSelection(selectedId) {
            const correctId = correctActivity.value;
            const independence = independenceSelect.value;
            const goal = goalSelect.value;
            const comments = commentsField.value.trim();
            const logEntry = {
                time: new Date().toLocaleString(),
                selectedActivity: selectedId,
                correctActivity: correctId,
                independence: independence,
                goal: goal,
                comments: comments,
                result: selectedId === correctId ? 'Correct' : 'Incorrect'
            };

            log.push(logEntry);
        }

        function saveSession() {
            const correctId = correctActivity.value;
            const goal = goalSelect.value;
            const independence = independenceSelect.value;
            const comments = commentsField.value.trim();

            const logEntryHtml = `
                <div class="session-entry">
                    <strong>Time:</strong> ${new Date().toLocaleString()}<br>
                    <strong>Selected Activity:</strong> ${correctId}<br>
                    <strong>Goal:</strong> ${goal}<br>
                    <strong>Independence:</strong> ${independence}<br>
                    <strong>Comments:</strong> ${comments || 'None'}<br>
                    <strong>Result:</strong> ${correctId === correctActivity.value ? 'Correct' : 'Incorrect'}
                </div>
            `;
            logEntries.insertAdjacentHTML('beforeend', logEntryHtml);
            commentsField.value = ''; // Clear comments after saving
        }

        function resetApp() {
            retryImg.style.display = 'none';
            document.getElementById('image-container').style.display = 'grid';
            resetButton.style.display = 'none';

            images.forEach(image => {
                image.classList.remove('full-screen');
            });
        }

        function exportLog() {
            let logContent = "IEP Goal Tracking Log\n";
            logContent += "Date and Time, Selected Activity, Correct Activity, Independence, Goal, Comments, Result\n";
            log.forEach(entry => {
                logContent += `${entry.time}, ${entry.selectedActivity}, ${entry.correctActivity}, ${entry.independence}, ${entry.goal}, ${entry.comments}, ${entry.result}\n`;
            });

            const now = new Date();
            const dateString = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;

            const blob = new Blob([logContent], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `IEP_Goal_Tracking_Log_${dateString}.txt`;
            link.click();
        }
    </script>

</body>
</html>
